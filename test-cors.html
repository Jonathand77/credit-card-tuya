<!DOCTYPE html>
<html>
<head>
    <title>CORS & Auth Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        #result { margin-top: 20px; padding: 15px; border: 1px solid #ccc; background: #f5f5f5; min-height: 100px; white-space: pre-wrap; font-family: monospace; font-size: 12px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Credit Card App - Network Test</h1>
    <div>
        <button onclick="testRegister()">Test Register</button>
        <button onclick="testLogin()">Test Login</button>
        <button onclick="testDirect()">Test Direct Fetch</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    <div id="result">Ready. Click a button to test...</div>
    
    <script>
        const log = (msg, isError = false) => {
            const el = document.getElementById('result');
            const timestamp = new Date().toLocaleTimeString();
            const line = `[${timestamp}] ${msg}`;
            el.innerHTML += (isError ? '<span class="error">' : '') + line + (isError ? '</span>' : '') + '\n';
            el.scrollTop = el.scrollHeight;
        };

        const clearLog = () => {
            document.getElementById('result').innerHTML = '';
        };

        async function testRegister() {
            clearLog();
            log('Starting register test...');
            log('POST to: http://127.0.0.1:5000/api/auth/register');
            
            const payload = {
                username: 'testuser' + Date.now(),
                email: 'test' + Date.now() + '@test.com',
                password: 'Pass123!'
            };
            log('Payload: ' + JSON.stringify(payload));
            
            try {
                log('Sending request...');
                const response = await fetch('http://127.0.0.1:5000/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                log('Response status: ' + response.status + ' ' + response.statusText);
                const data = await response.json();
                log('Response: ' + JSON.stringify(data, null, 2));
                
                if (data.token) {
                    log('✓ SUCCESS - Token received', false);
                } else {
                    log('✗ ERROR - No token in response', true);
                }
            } catch (error) {
                log('✗ FETCH ERROR: ' + error.message, true);
                log('Stack: ' + error.stack, true);
            }
        }

        async function testLogin() {
            clearLog();
            log('Starting login test...');
            log('POST to: http://127.0.0.1:5000/api/auth/login');
            
            const payload = {
                username: 'testuser',
                email: 'test@test.com',
                password: 'Pass123!'
            };
            log('Payload: ' + JSON.stringify(payload));
            
            try {
                log('Sending request...');
                const response = await fetch('http://127.0.0.1:5000/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                log('Response status: ' + response.status + ' ' + response.statusText);
                const data = await response.json();
                log('Response: ' + JSON.stringify(data, null, 2));
                
                if (data.token) {
                    log('✓ SUCCESS - Token received', false);
                } else {
                    log('✗ ERROR - No token in response', true);
                }
            } catch (error) {
                log('✗ FETCH ERROR: ' + error.message, true);
                log('Stack: ' + error.stack, true);
            }
        }

        async function testDirect() {
            clearLog();
            log('Testing direct GET request...');
            
            try {
                const response = await fetch('http://127.0.0.1:5000/weatherforecast');
                log('Status: ' + response.status);
                const data = await response.json();
                log('Data: ' + JSON.stringify(data, null, 2));
            } catch (error) {
                log('Error: ' + error.message, true);
            }
        }
    </script>
</body>
</html>
